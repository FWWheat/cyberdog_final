# 1.命令执行过程，建图
## `ros2 action send_goal /mi_desktop_48_b0_2d_7b_03_d0/start_algo_task protocol/action/Navigation "{nav_type: 5, map_name: 'vision_map', outdoor: true, object_tracking: false}"`
1. Action服务器实现
- 主要文件: cyberdog_nav2/algorithm_manager/src/algorithm_task_manager.cpp
- 头文件: cyberdog_nav2/algorithm_manager/include/algorithm_manager/algorithm_task_manager.hpp
```
  // 创建启动算法任务的Action服务器
  start_algo_task_server_ = rclcpp_action::create_server<AlgorithmMGR>(
    node_, "start_algo_task",
    std::bind(
      &AlgorithmTaskManager::HandleAlgorithmManagerGoal,             ----检查状态机是否有效
      this, std::placeholders::_1, std::placeholders::_2),
    std::bind(
      &AlgorithmTaskManager::HandleAlgorithmManagerCancel,
      this, std::placeholders::_1),
    std::bind(
      &AlgorithmTaskManager::HandleAlgorithmManagerAccepted,
      this, std::placeholders::_1), rcl_action_server_get_default_options());
```
2. Action接口定义
- Action类型: protocol::action::Navigation
- Action名称: /start_algo_task
- Goal结构:
```
  struct Goal {
      uint8_t nav_type;        // 任务类型ID (5=激光建图)
      string map_name;         // 地图名称 ("vision_map")
      bool outdoor;            // 户外模式 (true)
      bool object_tracking;    // 目标跟踪 (false)
  }
```

3. 任务类型定义
- 文件: cyberdog_nav2/algorithm_manager/include/algorithm_manager/algorithm_task_manager.hpp
- 关键枚举:
```
  enum class ManagerStatus {
      kExecutingLaserMapping = 5,     // 激光建图
      kExecutingVisMapping = 15,      // 视觉建图
      kExecutingLaserLocalization = 7,    // 激光定位
      kExecutingVisLocalization = 17,     // 视觉定位
      // ... 其他任务类型
  };
```

4. 执行器实现
- 视觉建图执行器: cyberdog_nav2/algorithm_manager/src/executor_vision_mapping.cpp
- 头文件: cyberdog_nav2/algorithm_manager/include/algorithm_manager/executor_vision_mapping.hpp
  - cyberdog_nav2/algorithm_manager/include/algorithm_manager/executor_base.hpp

  1. 启动阶段 (Start方法)
    - 位置: executor_vision_mapping.cpp:47-120
    - 函数：void ExecutorVisionMapping::Start(const AlgorithmMGR::Goal::ConstSharedPtr goal)
    - 关键步骤:
      - 依赖检查: 激活所有必需的生命周期节点
      - 建图服务启动: 调用start_vins_mapping服务
      - 状态反馈: 发送建图成功反馈
  2. 启动建图服务
    - 位置: executor_vision_mapping.cpp:182-210
    - 函数：bool ExecutorVisionMapping::StartBuildMapping()
    - 服务名称: start_vins_mapping
    - 服务类型: std_srvs::srv::SetBool
    - 功能: 启动视觉SLAM建图
    ```
    # 启动视觉建图
    ros2 service call /start_vins_mapping std_srvs/srv/SetBool "{data: true}"

    # 停止视觉建图
    ros2 service call /start_vins_mapping std_srvs/srv/SetBool "{data: false}"
    ```
  3. 生命周期节点激活
    - 位置: executor_vision_mapping.cpp:182-195
    - 函数：bool ExecutorVisionMapping::IsDependsReady()
    - 激活所有必需的生命周期节点
    - 检查相机和RGB-D传感器状态

5. 配置文件
- 任务配置: cyberdog_nav2/algorithm_manager/config/
- 参数配置: cyberdog_nav2/algorithm_manager/params/

6. 启动文件
- 导航启动: cyberdog_nav2/navigation_bringup/launch/navigation.launch.py
- 算法管理器启动: 在navigation.launch.py中第122行启动






# 2. 命令执行过程保存图像
## `ros2 run nav2_map_server map_saver_cli -f ~/vision_map --ros-args -r map:=/mi_desktop_48_b0_2d_7b_03_d0/map`
    - ros2 run nav2_map_server map_saver_cli - 运行nav2_map_server包中的map_saver_cli可执行文件
    - f ~/vision_map - 指定保存地图的文件名和路径
    * --ros-args - 表示后面是ROS2特定的参数
    * -r map:=/mi_desktop_48_b0_2d_7b_03_d0/map - 话题重映射

- cyberdog_ws/cyberdog_nav2/navigation2/nav2_map_server/README.md：介绍了怎么导入地图



