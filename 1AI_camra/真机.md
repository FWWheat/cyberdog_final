
开机直接运行
# topic
```
mi@mi-desktop:~$ ros2 topic list  | grep camera
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/transition_event
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/transition_event
/mi_desktop_48_b0_2d_7b_03_d0/camera/depth/color/points
/mi_desktop_48_b0_2d_7b_03_d0/camera/infra1/image_rect_raw
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/transition_event
mi@mi-desktop:~$ ros2 topic list  | grep image
/mi_desktop_48_b0_2d_7b_03_d0/camera/infra1/image_rect_raw
/mi_desktop_48_b0_2d_7b_03_d0/image
mi@mi-desktop:~$ 

```
# service

```
mi@mi-desktop:~$ ros2 service list | grep camera
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/change_state
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/describe_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_available_states
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_available_transitions
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_parameter_types
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_state
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/get_transition_graph
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/list_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/set_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera/set_parameters_atomically
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/change_state
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/describe_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_available_states
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_available_transitions
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_parameter_types
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_state
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/get_transition_graph
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/list_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/set_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera/camera_align/set_parameters_atomically
/mi_desktop_48_b0_2d_7b_03_d0/camera/realsense_frame_service
/mi_desktop_48_b0_2d_7b_03_d0/camera/realsense_recovery
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/describe_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/get_parameter_types
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/get_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/list_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/set_parameters
/mi_desktop_48_b0_2d_7b_03_d0/camera_server/set_parameters_atomically
/mi_desktop_48_b0_2d_7b_03_d0/camera_service
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/describe_parameters
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/get_parameter_types
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/get_parameters
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/list_parameters
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/set_parameters
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera/set_parameters_atomically
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/change_state
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/describe_parameters
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_available_states
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_available_transitions
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_parameter_types
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_parameters
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_state
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/get_transition_graph
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/list_parameters
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/set_parameters
/mi_desktop_48_b0_2d_7b_03_d0/stereo_camera/set_parameters_atomically
mi@mi-desktop:~$ 
```
# node
```
mi@mi-desktop:~$ ros2 node info /mi_desktop_48_b0_2d_7b_03_d0/camera_server
/mi_desktop_48_b0_2d_7b_03_d0/camera_server
  Subscribers:
    /mi_desktop_48_b0_2d_7b_03_d0/img_trans_signal_in: std_msgs/msg/String
    /parameter_events: rcl_interfaces/msg/ParameterEvent
  Publishers:
    /mi_desktop_48_b0_2d_7b_03_d0/img_trans_signal_out: std_msgs/msg/String
    /mi_desktop_48_b0_2d_7b_03_d0/speech_play: protocol/msg/AudioPlay
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
  Service Servers:
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/get_parameters: rcl_interfaces/srv/GetParameters
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/list_parameters: rcl_interfaces/srv/ListParameters
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/set_parameters: rcl_interfaces/srv/SetParameters
    /mi_desktop_48_b0_2d_7b_03_d0/camera_server/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
    /mi_desktop_48_b0_2d_7b_03_d0/camera_service: protocol/srv/CameraService
  Service Clients:
    /mi_desktop_48_b0_2d_7b_03_d0/camera_service: protocol/srv/CameraService
  Action Servers:

  Action Clients:
```
# 开启相机
```
mi@mi-desktop:~$ ros2 service call /camera_service protocol/srv/CameraService "{command: 9, width: 640, height: 480, fps: 0}"
waiting for service to become available...

检查一下 /camera_service 服务是由哪个节点提供的
/mi_desktop_48_b0_2d_7b_03_d0/camera_server 节点提供了 /mi_desktop_48_b0_2d_7b_03_d0/camera_service 服务
/mi_desktop_48_b0_2d_7b_03_d0/connector_ctrl_camera 节点也提供了 /mi_desktop_48_b0_2d_7b_03_d0/camera_service 服务
/mi_desktop_48_b0_2d_7b_03_d0/cyberdog_action 节点也提供了 /mi_desktop_48_b0_2d_7b_03_d0/camera_service 服务
没有任何节点提供 /camera_service 服务，但是有多个节点提供 /mi_desktop_48_b0_2d_7b_03_d0/camera_service 服务。

ros2 service call /mi_desktop_48_b0_2d_7b_03_d0/camera_service protocol/srv/CameraService "{command: 9, width: 640, height: 480, fps: 0}"
mi@mi-desktop:~$ ros2 service call /mi_desktop_48_b0_2d_7b_03_d0/camera_service protocol/srv/CameraSerce "{command: 9, width: 640, height: 480, fps: 0}"
waiting for service to become available...
requester: making request: protocol.srv.CameraService_Request(command=9, args='', width=640, height=480, fps=0)

response:
protocol.srv.CameraService_Response(result=0, msg='', code=0)

mi@mi-desktop:~$ ros2 topic list | grep image
/mi_desktop_48_b0_2d_7b_03_d0/camera/infra1/image_rect_raw
/mi_desktop_48_b0_2d_7b_03_d0/image



mi@mi-desktop:~$ ros2 topic info /mi_desktop_48_b0_2d_7b_03_d0/image
Type: sensor_msgs/msg/Image
Publisher count: 1
Subscription count: 2
mi@mi-desktop:~$ ros2 topic info /mi_desktop_48_b0_2d_7b_03_d0/image --verbose
Type: sensor_msgs/msg/Image

Publisher count: 1

Node name: camera_server
Node namespace: /mi_desktop_48_b0_2d_7b_03_d0
Topic type: sensor_msgs/msg/Image
Endpoint type: PUBLISHER
GID: 97.8b.10.01.42.95.65.0e.c0.c0.e9.1e.00.00.1d.03.00.00.00.00.00.00.00.00
QoS profile:
  Reliability: RELIABLE
  Durability: VOLATILE
  Lifespan: 9223372036854775807 nanoseconds
  Deadline: 9223372036854775807 nanoseconds
  Liveliness: AUTOMATIC
  Liveliness lease duration: 9223372036854775807 nanoseconds

Subscription count: 2

Node name: connector
Node namespace: /mi_desktop_48_b0_2d_7b_03_d0
Topic type: sensor_msgs/msg/Image
Endpoint type: SUBSCRIPTION
GID: 0c.c6.10.01.5c.fc.ab.60.e6.d3.3e.10.00.00.8a.04.00.00.00.00.00.00.00.00
QoS profile:
  Reliability: RELIABLE
  Durability: VOLATILE
  Lifespan: 9223372036854775807 nanoseconds
  Deadline: 9223372036854775807 nanoseconds
  Liveliness: AUTOMATIC
  Liveliness lease duration: 9223372036854775807 nanoseconds

Node name: cyberdog_action
Node namespace: /mi_desktop_48_b0_2d_7b_03_d0
Topic type: sensor_msgs/msg/Image
Endpoint type: SUBSCRIPTION
GID: ce.10.10.01.3f.8a.09.48.96.82.fd.fc.00.00.19.04.00.00.00.00.00.00.00.00
QoS profile:
  Reliability: RELIABLE
  Durability: VOLATILE
  Lifespan: 9223372036854775807 nanoseconds
  Deadline: 9223372036854775807 nanoseconds
  Liveliness: AUTOMATIC
  Liveliness lease duration: 9223372036854775807 nanoseconds
发布者 (Publisher):
节点名称：camera_server
命名空间：/mi_desktop_48_b0_2d_7b_03_d0
这就是您刚才启动的相机服务节点
订阅者 (Subscribers):
connector 节点 - 这是连接器节点，可能用于处理图像数据
cyberdog_action 节点 - 这是动作节点，可能用于AI处理或其他功能

``` 
# 开启之后，使用.py订阅话题，opencv显示
```
sudo apt install python3-opencv

mi@mi-desktop:~$ python3 view_camera_image.py 
[INFO] [1753717396.607422286] [camera_viewer]: 相机图像查看器已启动，订阅话题: /mi_desktop_48_b0_2d_7b_03_d0/image
[INFO] [1753717396.611290359] [camera_viewer]: 按 ESC 键退出
Unable to init server: Could not connect: Connection refused

(Camera Image:20596): Gtk-WARNING **: 23:43:16.617: cannot open display: 
ssh -X mi@192.168.42.61这样进入，确保X11显示正常

mi@mi-desktop:~$ ros2 topic info /mi_desktop_48_b0_2d_7b_03_d0/image
Type: sensor_msgs/msg/Image
Publisher count: 1
Subscription count: 3
mi@mi-desktop:~$ ros2 topic hz /mi_desktop_48_b0_2d_7b_03_d0/image
average rate: 28.669
	min: 0.020s max: 0.070s std dev: 0.01216s window: 30
average rate: 29.841
	min: 0.020s max: 0.070s std dev: 0.00998s window: 62
average rate: 29.767
	min: 0.016s max: 0.070s std dev: 0.00982s window: 93
average rate: 30.020
	min: 0.016s max: 0.070s std dev: 0.00905s window: 124
average rate: 29.622
	min: 0.016s max: 0.097s std dev: 0.01086s window: 153
average rate: 29.417
	min: 0.012s max: 0.097s std dev: 0.01068s window: 182
average rate: 29.073
	min: 0.012s max: 0.110s std dev: 0.01200s window: 209
average rate: 29.216
	min: 0.012s max: 0.110s std dev: 0.01156s window: 240

```
# 二维码识别代码
```
mi@mi-desktop:~/pyzbar$ sudo rm /etc/mr813_version
[sudo] password for mi: 
mi@mi-desktop:~/pyzbar$ pip3 install pyzbar
Collecting pyzbar
  Downloading https://files.pythonhosted.org/packages/6d/24/81ebe6a1c00760471a3028a23cbe0b94e5fa2926e5ba47adc895920887bc/pyzbar-0.1.9-py2.py3-none-any.whl
Installing collected packages: pyzbar
Successfully installed pyzbar-0.1.9


<!-- mi@mi-desktop:~/qr_detector_ws$ cp -rf install/qr_detector/lib/qr_detector /opt/ros2/cyberdog/lib
mi@mi-desktop:~/qr_detector_ws$ cp -rf install/qr_detector/share/qr_detector /opt/ros2/cyberdog/share
mi@mi-desktop:~/qr_detector_ws$ cp -rf install/qr_detector/share/ament_index/resource_index/packages/qr_detector /opt/ros2/cyberdog/share/ament_index/resource_index/packages -->

mi@mi-desktop:~/qr_detector_ws$ 
mi@mi-desktop:~/qr_detector_ws$ source /opt/ros2/galactic/setup.bash 
not found: "/opt/ros2/galactic/share/libg2o/local_setup.bash"
mi@mi-desktop:~/qr_detector_ws$ 


```




# AI相机
## 打开、关闭camera
`ros2 run camera_test camera_server`



## 开启AI相机指令

ros2 service call /mi_desktop_48_b0_2d_7b_03_d0/camera_service protocol/srv/CameraService "{command: 9, width: 640, height: 480, fps: 0}"



## 关闭相机指令

`ros2 service call /mi_desktop_48_b0_2d_7b_03_d0/camera_service protocol/srv/CameraService "{command: 10, args: ''}"`

## 获取图像
- 接口形式：ros topic

- 接口名称：camera_server

- 话题名称：topic: /image

- 图像数据话题内容: sensor_msgs::msg::Image




# 具体过程
## 0. 进入小狗：
- `ssh -X mi@192.168.42.61`
## 1. 开启ai相机：
- `ros2 run camera_test camera_server`
- `ros2 service call /mi_desktop_48_b0_2d_7b_03_d0/camera_service protocol/srv/CameraService "{command: 9, width: 640, height: 480, fps: 0}"`
## 2. 下载opencv:
- `sudo apt update`
- `sudo apt upgrade`
- `sudo apt install python3-opencv`

## 3. 写一个.py文件并运行，订阅相机输出利用opencv显示：view_camera_image
- `python3 view_camera_image.py`

## 4. 将编译好的qr_detection_ws包复制到狗中

## 5. 运行二维码识别节点
- ` sudo rm /etc/mr813_version`
- `pip3 install pyzbar`

<!-- - `cp -rf install/qr_detector/lib/qr_detector /opt/ros2/cyberdog/lib`
- `cp -rf install/qr_detector/share/qr_detector /opt/ros2/cyberdog/share`
- `cp -rf install/qr_detector/share/ament_index/resource_index/packages/qr_detector /opt/ros2/cyberdog/share/ament_index/resource_index/packages` -->

- `source /opt/ros2/galactic/setup.bash`
- `source install/setup.bash`
- `ros2 run qr_detector qr_detector_node.py`


